<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marketplace - Recomputech</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- AOS Animation -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../css/marketplace.css">
</head>
<body>
    <!-- Dynamic Header based on authentication status -->
    <div id="headerContainer">
        <!-- Header will be loaded dynamically -->
    </div>
    
    <!-- Marketplace Banner -->
    <section class="marketplace-banner">
        <div class="container">
            <div class="banner-content">
                <h1 class="banner-title">Our Catalog</h1>
                <p class="banner-subtitle">Discover high-quality refurbished technology with warranty and quality certification</p>
                
                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" class="search-input" placeholder="Search products..." id="searchInput">
                </div>
            </div>
        </div>
    </section>

    <!-- Mobile Filter Toggle -->
    <button class="mobile-filter-toggle" onclick="toggleSidebar()" style="display: none;">
        <i class="fas fa-filter"></i>
    </button>

    <!-- Sidebar Overlay -->
    <div class="sidebar-overlay" onclick="closeSidebar()"></div>

    <!-- Main Content -->
    <div class="marketplace-content">
        <div class="container-fluid">
            <div class="row">
                <!-- Sidebar Filters -->
                <div class="col-lg-3 col-md-4">
                    <div class="sidebar">
                        <h3 class="sidebar-title">
                            <i class="fas fa-filter"></i>
                            Filters
                        </h3>

                        <!-- Categories -->
                        <div class="filter-section">
                            <label class="filter-label">Categories</label>
                            <div class="category-filters">
                                <div class="category-item active" data-category="all">
                                    <i class="fas fa-border-all category-icon"></i>
                                    <span>All Products</span>
                        </div>
                                <div class="category-item" data-category="PCs Refurbished">
                                    <i class="fas fa-desktop category-icon"></i>
                                    <span>Desktop PCs</span>
                            </div>
                                <div class="category-item" data-category="Smartphones Refurbished">
                                    <i class="fas fa-mobile-alt category-icon"></i>
                                    <span>Smartphones</span>
                            </div>
                                <div class="category-item" data-category="Tablets">
                                    <i class="fas fa-tablet-alt category-icon"></i>
                                    <span>Tablets</span>
                        </div>
                                <div class="category-item" data-category="Mini PCs">
                                    <i class="fas fa-laptop category-icon"></i>
                                    <span>Mini PCs</span>
                            </div>
                            </div>
                        </div>

                        <!-- Price Range -->
                        <div class="filter-section">
                            <label class="filter-label">Price Range</label>
                            <div class="price-range">
                                <div class="price-inputs">
                                    <input type="number" class="price-input" placeholder="Min" id="minPrice">
                                    <input type="number" class="price-input" placeholder="Max" id="maxPrice">
                    </div>
                                <input type="range" class="price-slider" min="0" max="1000" value="500" id="priceSlider">
                                <div class="d-flex justify-content-between">
                                    <small>$ 0</small>
                                    <small>$ 1000</small>
                            </div>
                            </div>
                        </div>

                        <!-- Brands -->
                        <div class="filter-section">
                            <label class="filter-label">Brands</label>
                            <div class="brand-filters">
                                <div class="brand-item">
                                    <input type="checkbox" class="brand-checkbox" id="dell" value="DELL">
                                    <label for="dell">DELL</label>
                    </div>
                                <div class="brand-item">
                                    <input type="checkbox" class="brand-checkbox" id="hp" value="HP">
                                    <label for="hp">HP</label>
                </div>
                                <div class="brand-item">
                                    <input type="checkbox" class="brand-checkbox" id="lenovo" value="Lenovo">
                                    <label for="lenovo">Lenovo</label>
                        </div>
                                <div class="brand-item">
                                    <input type="checkbox" class="brand-checkbox" id="apple" value="Apple">
                                    <label for="apple">Apple</label>
                            </div>
                                <div class="brand-item">
                                    <input type="checkbox" class="brand-checkbox" id="samsung" value="Samsung">
                                    <label for="samsung">Samsung</label>
                            </div>
                            </div>
                        </div>

                        <!-- Condition -->
                        <div class="filter-section">
                            <label class="filter-label">Condition</label>
                            <div class="condition-filters">
                                <div class="condition-item">
                                    <input type="checkbox" class="condition-checkbox" id="refurbished" value="refurbished" checked>
                                    <label for="refurbished">Refurbished</label>
                    </div>
                                <div class="condition-item">
                                    <input type="checkbox" class="condition-checkbox" id="excellent" value="excellent" checked>
                                    <label for="excellent">Excellent</label>
                </div>
                                <div class="condition-item">
                                    <input type="checkbox" class="condition-checkbox" id="good" value="good">
                                    <label for="good">Good</label>
                            </div>
                            </div>
                        </div>

                        <!-- Apply Button -->
                        <button class="apply-filters" onclick="applyFilters()">
                            <i class="fas fa-check"></i>
                            Apply Filters
                        </button>
                    </div>
                </div>

                <!-- Products Section -->
                <div class="col-lg-9 col-md-8">
                    <div class="products-section">
                        <div class="products-header">
                            <div class="results-count">
                                <span id="resultsCount">8</span> products found
                            </div>
                            <select class="sort-select" id="sortSelect">
                                <option value="name">Sort by Name</option>
                                <option value="price-low">Price: Low to High</option>
                                <option value="price-high">Price: High to Low</option>
                                <option value="discount">Highest Discount</option>
                            </select>
                        </div>

                        <div class="products-grid" id="productsGrid">
                            <!-- Products will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Footer Component -->
    <recomputech-footer></recomputech-footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    
    <!-- Web Components -->
    <script src="../components/header-component.js"></script>
    <script src="../components/header-auth-component.js"></script>
    <script src="../components/header-auth-technician-component.js"></script>
    <script src="../components/footer-component.js"></script>
    
    <!-- Header Manager -->
    <script src="../js/header-manager.js"></script>
    
    <!-- Product Data -->
    <script src="products/product-data.js"></script>
    
    <!-- Marketplace Script -->
    <script>
        let allProducts = [];
        let filteredProducts = [];
        let currentFilters = {
            category: 'all',
            minPrice: 0,
            maxPrice: 1000,
            brands: [],
            conditions: ['refurbished', 'excellent'],
            searchTerm: ''
        };

        document.addEventListener('DOMContentLoaded', function() {
            // Initialize AOS
            AOS.init({
                duration: 800,
                easing: 'ease-in-out',
                once: true
            });

            // Load products
            loadProducts();

            // Setup event listeners
            setupEventListeners();
        });

        function loadProducts() {
            // Get all products from the database
            allProducts = Object.values(PRODUCTS_DATABASE);
            filteredProducts = [...allProducts];
            
            renderProducts();
        }

        function renderProducts() {
            const productsGrid = document.getElementById('productsGrid');
            const resultsCount = document.getElementById('resultsCount');
            
            resultsCount.textContent = filteredProducts.length;
            
            if (filteredProducts.length === 0) {
                productsGrid.innerHTML = `
                    <div class="col-12 text-center py-5">
                        <i class="fas fa-search" style="font-size: 3rem; color: #94a3b8;"></i>
                        <h3 class="mt-3">No products found</h3>
                        <p class="text-muted">Try adjusting your search filters</p>
                    </div>
                `;
                return;
            }

            productsGrid.innerHTML = filteredProducts.map(product => `
                <div class="product-card" data-aos="fade-up">
                    <div class="product-image">
                        <img src="${product.images[0]}" alt="${product.name}" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <div style="display: none; width: 100%; height: 100%; align-items: center; justify-content: center; color: white; font-size: 3rem;">
                            <i class="fas fa-laptop"></i>
                        </div>
                        <div class="product-discount">${product.discount}% OFF</div>
          </div>
                    <div class="product-info">
                        <div class="product-category">${product.category}</div>
                        <h3 class="product-title">${product.name}</h3>
                        <p class="product-description">${product.description.substring(0, 100)}...</p>
                        
                        <div class="product-price-container">
                            <span class="product-price">$ ${product.price.toFixed(2)}</span>
                            <span class="product-original-price">$ ${product.originalPrice.toFixed(2)}</span>
            </div>
                        
                        <div class="product-rating">
                            <div class="product-stars">
                                ${generateStars(product.seller.rating)}
              </div>
                            <span class="product-rating-text">(${product.seller.rating})</span>
              </div>
                        
                        <div class="product-actions">
                            <a href="products/product-detail.html?id=${product.id}" class="btn-view-details">
                                <i class="fas fa-eye"></i>
                                View Details
                            </a>
                            <button class="btn-add-cart" onclick="addToCart('${product.id}')">
                                <i class="fas fa-shopping-cart"></i>
              </button>
            </div>
          </div>
        </div>
            `).join('');
        }

        function generateStars(rating) {
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 !== 0;
            const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);
            
            let stars = '';
            for (let i = 0; i < fullStars; i++) {
                stars += '<i class="fas fa-star"></i>';
            }
            if (hasHalfStar) {
                stars += '<i class="fas fa-star-half-alt"></i>';
            }
            for (let i = 0; i < emptyStars; i++) {
                stars += '<i class="far fa-star"></i>';
            }
            return stars;
        }

        function addToCart(productId) {
            const product = getProductById(productId);
            if (!product) return;

            const header = document.querySelector('recomputech-header') || document.querySelector('recomputech-header-auth');
            if (header) {
                header.addToCart(product);
            }
        }

        function setupEventListeners() {
            // Search functionality
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', (e) => {
                currentFilters.searchTerm = e.target.value.toLowerCase();
                applyFilters();
            });

            // Category filters
            const categoryItems = document.querySelectorAll('.category-item');
            categoryItems.forEach(item => {
                item.addEventListener('click', () => {
                    categoryItems.forEach(cat => cat.classList.remove('active'));
                    item.classList.add('active');
                    currentFilters.category = item.dataset.category;
                    applyFilters();
                });
            });

            // Price range
            const priceSlider = document.getElementById('priceSlider');
            const minPriceInput = document.getElementById('minPrice');
            const maxPriceInput = document.getElementById('maxPrice');

            priceSlider.addEventListener('input', (e) => {
                currentFilters.maxPrice = parseInt(e.target.value);
                maxPriceInput.value = e.target.value;
            });

            minPriceInput.addEventListener('input', (e) => {
                currentFilters.minPrice = parseInt(e.target.value) || 0;
            });

            maxPriceInput.addEventListener('input', (e) => {
                currentFilters.maxPrice = parseInt(e.target.value) || 1000;
            });

            // Sort functionality
            const sortSelect = document.getElementById('sortSelect');
            sortSelect.addEventListener('change', sortProducts);
        }

        function applyFilters() {
            filteredProducts = allProducts.filter(product => {
                // Category filter
                if (currentFilters.category !== 'all' && product.category !== currentFilters.category) {
                    return false;
                }

                // Price filter
                if (product.price < currentFilters.minPrice || product.price > currentFilters.maxPrice) {
                    return false;
                }

                // Search filter
                if (currentFilters.searchTerm) {
                    const searchTerm = currentFilters.searchTerm;
                    const matchesSearch = product.name.toLowerCase().includes(searchTerm) ||
                                        product.description.toLowerCase().includes(searchTerm) ||
                                        product.tags.some(tag => tag.toLowerCase().includes(searchTerm));
                    if (!matchesSearch) return false;
                }

                // Brand filter
                const selectedBrands = Array.from(document.querySelectorAll('.brand-checkbox:checked')).map(cb => cb.value);
                if (selectedBrands.length > 0) {
                    const productBrand = getProductBrand(product.name);
                    if (!selectedBrands.includes(productBrand)) {
                        return false;
                    }
                }

                return true;
            });
            
            sortProducts();
        }

        function getProductBrand(productName) {
            if (productName.includes('DELL')) return 'DELL';
            if (productName.includes('HP')) return 'HP';
            if (productName.includes('Lenovo')) return 'Lenovo';
            if (productName.includes('iPhone') || productName.includes('iPad') || productName.includes('Apple')) return 'Apple';
            if (productName.includes('Galaxy') || productName.includes('Samsung')) return 'Samsung';
            return 'Other';
        }

        function sortProducts() {
            const sortBy = document.getElementById('sortSelect').value;
            
            filteredProducts.sort((a, b) => {
                switch (sortBy) {
                    case 'name':
                        return a.name.localeCompare(b.name);
                    case 'price-low':
                        return a.price - b.price;
                    case 'price-high':
                        return b.price - a.price;
                    case 'discount':
                        return b.discount - a.discount;
                    default:
                        return 0;
                }
            });
            
            renderProducts();
        }

        // Mobile sidebar functions
        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const overlay = document.querySelector('.sidebar-overlay');
            
            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');
        }

        function closeSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const overlay = document.querySelector('.sidebar-overlay');
            
            sidebar.classList.remove('active');
            overlay.classList.remove('active');
        }

        // Close sidebar when clicking outside on mobile
        document.addEventListener('click', function(e) {
            if (window.innerWidth <= 1200) {
                const sidebar = document.querySelector('.sidebar');
                const toggleBtn = document.querySelector('.mobile-filter-toggle');
                
                if (!sidebar.contains(e.target) && !toggleBtn.contains(e.target)) {
                    closeSidebar();
                }
            }
        });
    </script>
</body>
</html>